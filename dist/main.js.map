{"mappings":";;;;;;;;;;;;;;AAAA,EAKK,AALL,wHAKK,AALL,EAKK,CACL,EAAO,AAAP,aAAe;AACP,KAAH,CAAC,2BAAK,GAAG,KAAsC;AAIpD,KAAK,CAAC,2BAAK,GAAG,CAAC;IACX,KAAK,EAAE,0DAAQ,CAAC,CAAC;IAAA,CAAC;IAClB,OAAO,EAAE,CAAC;IAAA,CAAC;IACX,OAAO,EAAC,GAAG,EAAE,CAAC;QACV,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG;IACzB,CAAC;IACD,GAAG,EAAC,GAAG,EAAE,QAAQ,EAAE,CAAC;QAChB,MAAM,CAAC,GAAG,CAAC,OAAO,EAAE,OAAO,EAAE,MAAM,GAAK,CAAC;YACrC,EAAE,EAAE,IAAI,CAAC,OAAO,CAAC,GAAG,GAAG,CAAC;gBACpB,IAAI,CAAC,KAAK,CAAC,GAAG,IAAI,QAAQ;gBAC1B,OAAO,CAAC,GAAG,CAAC,CAAiB,kBAAE,GAAG,EAAE,CAAI,KAAE,IAAI,CAAC,KAAK,CAAC,GAAG;gBACxD,OAAO,CAAC,QAAQ;YACpB,CAAC,MACG,MAAM,EAAE,aAAa,EAAE,GAAG,CAAC,0CAA0C;QAE7E,CAAC;IACL,CAAC;IACD,GAAG,EAAC,GAAG,EAAE,CAAC;QACN,EAAE,EAAE,GAAG,IAAI,GAAG,CAAC,KAAK,EAAE,CAAC;YACnB,EAAE,EAAE,IAAI,CAAC,OAAO,CAAC,GAAG,GAChB,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG;iBAErB,MAAM,CAAC,GAAG,CAAC,KAAK,EAAE,aAAa,EAAE,GAAG,CAAC,mCAAmC;QAEhF,CAAC;IACL,CAAC;IACD,MAAM,EAAC,GAAG,EAAE,MAAM,EAAE,CAAC;QACjB,MAAM,CAAC,GAAG,CAAC,OAAO,EAAE,OAAO,EAAE,MAAM,GAAK,CAAC;YACrC,EAAE,EAAE,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,MAAM,CAAU,WAAE,CAAC;gBAC1C,KAAK,CAAC,YAAY,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,EAAE,CAAC;oBACpC,GAAG,EAAE,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,2BAAK;oBACxB,GAAG,EAAE,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,2BAAK;gBAC5B,CAAC,EAAE,MAAM;gBAET,EAAE,EAAE,YAAY,IAAK,MAAM,CAAC,YAAY,CAAC,IAAI,KAAK,CAAU,WACxD,EAAoB,AAApB,sBAAwB;gBACpB,YAAQ,CAAC,IAAI,EAAC,IAAI,GAAI,CAAC;oBACvB,EAAE,EAAE,IAAI,CAAC,OAAO,CAAC,GAAG,GAChB,EAA2B,AAA3B,6CAA+C;oBAC3B,IAAhB,CAAC,GAAG,CAAC,GAAG,EAAE,IAAI;oBAEtB,OAAO,CAAC,IAAI;gBAChB,CAAC,EAAE,KAAK,CAAC,MAAM;qBAEf,OAAO,CAAC,YAAY;YAE5B,CAAC,MACG,MAAM,EAAE,gBAAgB,EAAE,GAAG,CAAC,GAAG,EAAE,MAAM,CAAC,qCAAqC;QAEvF,CAAC;IACL,CAAC;AACL,CAAC;kDAEiC,GAAG,EAAE,OAAO,EAAE,CAAC;IAC7C,EAAE,EAAC,GAAG,KAAK,GAAG,CAAC,KAAK,IAAI,GAAG,CAAC,OAAO,KAAK,OAAO,KAAG,IAAI,CAAC,CAAC,EAAE,CAAC;QACvD,OAAO,GAAG,GAAG;QACb,GAAG,GAAG,IAAI;IACd,CAAC;IAED,EAAE,EAAE,OAAO,EAAE,CAAC;QACV,EAAW,AAAX,aAAe;QACX,GAAD,CAAC,WAAW,GAAG,OAAO,CAAC,KAAK,IAAI,CAAC;QAAA,CAAC;QACrC,EAAE,EAAE,MAAM,CAAC,WAAW,KAAK,CAAU,WACjC,WAAW,GAAG,WAAW,MAAM,CAAC;QAAA,CAAC;QAErC,KAAK,CAAC,UAAU,GAAG,MAAM,CAAC,MAAM,CAAC,2BAAK,CAAC,KAAK,EAAE,WAAW;QACzD,2BAAK,CAAC,KAAK,GAAG,0DAAQ,CAAC,UAAU;QAEjC,EAAY,AAAZ,cAAY;QACZ,MAAM,CAAC,MAAM,CAAC,2BAAK,CAAC,OAAO,EAAE,OAAO,CAAC,OAAO,IAAI,CAAC;QAAA,CAAC;IACtD,CAAC;IAGD,EAAE,EAAE,GAAG,EAAE,CAAC;QACN,EAAE,EAAE,0DAAM,EAAE,CAAC;YACT,2BAAK,IAAI,OAAO,CAAC,GAAG,CAAC,CAAgB;YACrC,GAAG,CAAC,MAAM,CAAC,gBAAgB,CAAC,MAAM,GAAG,2BAAK;QAC9C,CAAC,MAAM,EAAE,EAAE,0DAAM,EAAE,CAAC;YAChB,2BAAK,IAAI,OAAO,CAAC,GAAG,CAAC,CAAgB;YACrC,GAAG,CAAC,SAAS,CAAC,MAAM;QACxB,CAAC;IACL,CAAC;IAED,MAAM,CAAC,2BAAK;AAChB,CAAC;AAEM,KAAK,CAAC,yCAAO,GAAG,CAAC;IACpB,OAAO,EAAE,wCAAS;AACtB,CAAC","sources":["src/store.js"],"sourcesContent":["/**\r\n * Store Vue状态管理插件\r\n * Store.set(key, value)\r\n * Store.get(key)\r\n * Store.action(key).then().catch()\r\n * */\r\n// 调试开关\r\nconst DEBUG = process.env.NODE_ENV === \"development\";\r\n\r\nimport { isVue2, isVue3, reactive } from \"vue-demi\";\r\n\r\nconst store = {\r\n    state: reactive({}),\r\n    actions: {},\r\n    inStore(key) {\r\n        return this.state[key] !== void (0)\r\n    },\r\n    set(key, newValue) {\r\n        return new Promise((resolve, reject) => {\r\n            if (this.inStore(key)) {\r\n                this.state[key] = newValue;\r\n                console.log('[Store] update:', key, '=>', this.state[key])\r\n                resolve(newValue)\r\n            } else {\r\n                reject(`[Store] set(\"${key}\", value): the key has not registered yet!`)\r\n            }\r\n        })\r\n    },\r\n    get(key) {\r\n        if (key && key.split) {\r\n            if (this.inStore(key)) {\r\n                return this.state[key]\r\n            } else {\r\n                return new Error(`[Store] get(\"${key}\"): the key has not registered yet!`)\r\n            }\r\n        }\r\n    },\r\n    action(key, payoud) {\r\n        return new Promise((resolve, reject) => {\r\n            if (typeof this.actions[key] === 'function') {\r\n                const actionReturn = this.actions[key]({\r\n                    get: this.get.bind(store),\r\n                    set: this.set.bind(store)\r\n                }, payoud);\r\n\r\n                if (actionReturn && (typeof actionReturn.then === 'function')) {\r\n                    // action 返回 Promise\r\n                    actionReturn.then(data => {\r\n                        if (this.inStore(key)) {\r\n                            // action 有同名 state ，触发自动模式\r\n                            this.set(key, data)\r\n                        }\r\n                        resolve(data)\r\n                    }).catch(reject)\r\n                } else {\r\n                    resolve(actionReturn)\r\n                }\r\n            } else {\r\n                reject(`[Store] action(\"${key}\", ${payoud}): the action has not registered yet!`)\r\n            }\r\n        })\r\n    }\r\n}\r\n\r\nexport default function installer(app, options) {\r\n    if(app && (app.state || app.actions) && options===void(0)){\r\n        options = app;\r\n        app = null;\r\n    }\r\n\r\n    if (options) {\r\n        // 合并 state\r\n        let optionState = options.state || {}\r\n        if (typeof optionState === 'function') {\r\n            optionState = optionState() || {}\r\n        }\r\n        const mergeState = Object.assign(store.state, optionState)\r\n        store.state = reactive(mergeState)\r\n\r\n        // 合并 action\r\n        Object.assign(store.actions, options.actions || {})\r\n    }\r\n\r\n\r\n    if (app) {\r\n        if (isVue3) {\r\n            DEBUG && console.log('[Store] isVue3')\r\n            app.config.globalProperties.$store = store\r\n        } else if (isVue2) {\r\n            DEBUG && console.log('[Store] isVue2')\r\n            app.prototype.$store = store\r\n        }\r\n    }\r\n\r\n    return store\r\n}\r\n\r\nexport const install = {\r\n    install: installer\r\n}"],"names":[],"version":3,"file":"main.js.map"}