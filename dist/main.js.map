{"mappings":"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","sources":["src/store.js"],"sourcesContent":["/**\r\n * Store Vue状态管理插件\r\n * Store.set(key, value)\r\n * Store.get(key)\r\n * Store.action(key).then().catch()\r\n * */\r\nimport { reactive } from \"vue\";\r\n\r\nexport const store = {\r\n    state: {},\r\n    actions: {},\r\n    inStore(key) {\r\n        return this.state[key] !== void (0)\r\n    },\r\n    set(key, newValue) {\r\n        return new Promise((resolve, reject) => {\r\n            if (this.inStore(key)) {\r\n                this.state[key] = newValue;\r\n                console.log('[Store] update:', key, '=>', this.state[key])\r\n                resolve(newValue)\r\n            } else {\r\n                reject(`[Store] set(\"${key}\", value): the key has not registered yet!`)\r\n            }\r\n        })\r\n    },\r\n    get(key) {\r\n        if (key && key.split) {\r\n            if (this.inStore(key)) {\r\n                return this.state[key]\r\n            } else {\r\n                return new Error(`[Store] get(\"${key}\"): the key has not registered yet!`)\r\n            }\r\n        }\r\n    },\r\n    action(key, payoud) {\r\n        return new Promise((resolve, reject) => {\r\n            if (typeof this.actions[key] === 'function') {\r\n                const actionReturn = this.actions[key]({\r\n                    get: this.get.bind(store),\r\n                    set: this.set.bind(store)\r\n                }, payoud);\r\n\r\n                if (actionReturn && (typeof actionReturn.then === 'function')) {\r\n                    // action 返回 Promise\r\n                    actionReturn.then(data => {\r\n                        if (this.inStore(key)) {\r\n                            // action 有同名 state ，触发自动模式\r\n                            this.set(key, data)\r\n                        }\r\n                        resolve(data)\r\n                    }).catch(reject)\r\n                } else {\r\n                    resolve(actionReturn)\r\n                }\r\n            } else {\r\n                reject(`[Store] action(\"${key}\", ${payoud}): the action has not registered yet!`)\r\n            }\r\n        })\r\n    }\r\n}\r\n\r\nexport default {\r\n    install: function (app, options) {\r\n        // 合并 state\r\n        let optionState = options.state || {}\r\n        if(typeof optionState === 'function'){\r\n            optionState = optionState() || {}\r\n        }\r\n        const mergeState = Object.assign(store.state, optionState)\r\n        // 合并 action\r\n        Object.assign(store.actions, options.actions || {})\r\n\r\n        if (reactive) {\r\n            // vue 3\r\n            store.state = reactive(mergeState)\r\n\r\n            app.config.globalProperties.$store = store\r\n        } else if(app.observable) {\r\n            // vue 2\r\n            store.state = app.observable(mergeState)\r\n            \r\n            app.$store = app.prototype.$store = store\r\n        }\r\n\r\n    }\r\n}"],"names":[],"version":3,"file":"main.js.map"}